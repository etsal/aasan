From 12b14dc77b450d4fcb78ae2ad0dec24d0319b838 Mon Sep 17 00:00:00 2001
From: Emil Tsalapatis <emil@etsalapatis.com>
Date: Wed, 2 Jul 2025 14:55:49 -0400
Subject: [PATCH 1/9] [llvm] AddressSanitizer: add option for per-address space
 instrumentation

---
 llvm/lib/Transforms/Instrumentation/AddressSanitizer.cpp | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/llvm/lib/Transforms/Instrumentation/AddressSanitizer.cpp b/llvm/lib/Transforms/Instrumentation/AddressSanitizer.cpp
index 840a5e3f3..5ac22c707 100644
--- a/llvm/lib/Transforms/Instrumentation/AddressSanitizer.cpp
+++ b/llvm/lib/Transforms/Instrumentation/AddressSanitizer.cpp
@@ -410,8 +410,7 @@ static cl::opt<bool>
 
 static cl::opt<bool>
     ClUseOdrIndicator("asan-use-odr-indicator",
-                      cl::desc("Use odr indicators to improve ODR reporting"),
-                      cl::Hidden, cl::init(true));
+                      cl::desc("Use odr indicators to improve ODR reporting"), cl::Hidden, cl::init(true));
 
 static cl::opt<bool>
     ClUseGlobalsGC("asan-globals-live-support",
@@ -435,6 +434,11 @@ static cl::opt<AsanDtorKind> ClOverrideDestructorKind(
                           "Use global destructors")),
     cl::init(AsanDtorKind::Invalid), cl::Hidden);
 
+static cl::list<int> ClAddrSpaces("asan-instrument-address-spaces",
+	cl::desc("Only instrument variables in the specified address spaces."
+		"Incompatible with globals and stack sanitization [EXPERIMENTAL]"),
+        cl::Hidden, cl::CommaSeparated, cl::ZeroOrMore);
+
 // Debug flags.
 
 static cl::opt<int> ClDebug("asan-debug", cl::desc("debug"), cl::Hidden,
-- 
2.49.0

